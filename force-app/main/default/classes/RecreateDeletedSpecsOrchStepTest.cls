@isTest
public class RecreateDeletedSpecsOrchStepTest {
    
    static testMethod void createOchestrationProcessTestForOrder() {
        Account acc = new Account(Name='Test Account');
        
        Opportunity testOpp = ProductTestFactory.getOpportunityBasic(acc);
    	testOpp.StageName = 'Define';
        testOpp.CloseDate = System.Date.today();
        insert testOpp;
        
        csord__Order__c ord = new csord__Order__c();
        ord.csord__Identification__c = 'test identification';
        ord.Name = 'test order1';
        ord.csord__Status2__c = 'Pending';
        insert ord;
        
        csord__Order__c ord1 = new csord__Order__c();
        ord1.csord__Identification__c = 'test identification';
        ord1.Name = 'test order';
        ord1.csord__Status2__c = 'Pending';
        ord1.csordtelcoa__Opportunity__c = testOpp.id;
        insert ord1;
        
        list<CSPOFA__Orchestration_Process_Template__c> orcheList = new list<CSPOFA__Orchestration_Process_Template__c>();
        CSPOFA__Orchestration_Process_Template__c orchProcessTemplate1 = new CSPOFA__Orchestration_Process_Template__c();
        orchProcessTemplate1.Name = 'Order Fulfilment Process';
        orchProcessTemplate1.CSPOFA__Process_Type__c = 'New Provide';
        orchProcessTemplate1.CSPOFA__Processing_Mode__c = 'Foreground';
        orcheList.add(orchProcessTemplate1);
        insert orcheList;
        
       
        csord__Subscription__c subs=new csord__Subscription__c();
        subs.name  = 'test subs';
        subs.csord__Identification__c = 'test identity';
        subs.csord__Status__c = 'Pending';
        subs.csord__Order__c = ord.id;
        insert subs;
        
        csord__Service__c serv = new csord__Service__c();
        serv.name ='tst service1';
        serv.csord__Identification__c  = 'test identify1';
        serv.csordtelcoa__Service_Number__c = '46543221';
        serv.csord__Subscription__c = subs.id;
        serv.csord__Order__c = ord.id;
        insert serv;
        
        csord__Service__c serv1 = new csord__Service__c();
        serv1.name ='tst service1';
        serv1.csord__Identification__c  = 'test identify1';
        serv1.csordtelcoa__Service_Number__c = '46543221';
        serv1.csord__Subscription__c = subs.id;
        serv1.csordtelcoa__Replaced_Service__c = serv.id;
        serv1.csord__Order__c = ord1.id;
        insert serv1;
        
        List<Attachment> atts = new List<Attachment>();
        Attachment att1 = new Attachment();
        att1.Body = Blob.valueOf('{ "legacyAttributes" : [ ], "serviceId" : "'+serv.Id+'", "specifications" : [ { "additionalAttributes" : { "IPWirelessProductInstanceID" : "91699412-512f-f8bd-2950-dedb06b0d13b", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "IPWirelessProductInstanceID" : "DMCAT_ProductSpecification_000018_Fulfilment", "__targetSystem" : "FULFILMENT", "SERVICEPROFILE" : "DATA_BACKUP", "MESSAGEBANK" : "NA", "INTROAM" : "NA", "CONTEXT" : "NA", "CALLCONTROL" : "NA", "AccessRole" : "Primary", "BillofMaterialID" : "160f44ab-6be5-433f-ab5e-750f44b8b19b", "SERVICEID" : "61429751286", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "", "ShippingRequired" : "TRUE", "IMSI" : "", "SIMSerialNumber" : "" }, "code" : "DMCAT_ProductSpecification_000263_Fulfilment", "description" : "", "endDate" : "", "guid" : "963263ce-cb0a-64cd-17d6-06b524f533e2", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "ASSURANCE", "ServiceManagementOption " : "1" }, "code" : "DMCAT_ProductSpecification_000326_Assurance", "description" : "", "endDate" : "", "guid" : "68af7760-5543-670c-1454-489b1e40d1ca", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Telstra Managed Service Option 1_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000326", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "T22E_MIA_DATPLAN", "type" : "Domestic Data", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Mobile", "billDescription" : "Mobile Interim Access Allowance", "SERVICEID" : "61429751286", "IMSI" : "" }, "code" : "DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "description" : "", "endDate" : "", "guid" : "4acc4396-bddd-31c9-71f8-77930cb5a68c", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "ocsProd3", "type" : "Dummy ngUC", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Voice", "billDescription" : "ngUC Dummy Usage Specification Allowance" }, "code" : "DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "description" : "", "endDate" : "", "guid" : "960b0d11-c4b0-21e9-d2a9-6f1aa15cd193", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "BSServiceTypeProductInstanceID" : "c557bd15-31b3-ccea-b9da-a9182979ac51", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "BSServiceTypeProductInstanceID" : "DMCAT_ProductSpecification_000312_Fulfilment", "__targetSystem" : "FULFILMENT", "CustomerFacingServiceId" : "", "CustomerPreferredName" : "", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "" }, "code" : "DMCAT_ProductSpecification_000322_Fulfilment", "description" : "", "endDate" : "", "guid" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Site_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000322", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "InternetProtectionSolutionProductInstanceID" : "97754883-23a9-375b-3af8-b991e4733a61" }, "attributes" : { "__targetSystem" : "FULFILMENT", "UserProtectionType" : "Web and Mail", "InternetProtectionSolutionProductInstanceID" : "DMCAT_ProductSpecification_000163_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000162_Fulfilment", "description" : "", "endDate" : "", "guid" : "79d6ca6f-8288-aadc-8247-e939262c37d3", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Web and Mail Internet Protection User_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000162", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "68af7760-5543-670c-1454-489b1e40d1ca" }, "attributes" : { "__targetSystem" : "ASSURANCE", "parentSpec" : "DMCAT_ProductSpecification_000326_Assurance", "ResponseTarget" : "", "RestoreTarget" : "" }, "code" : "DMCAT_ProductSpecification_000151_Assurance", "description" : "", "endDate" : "", "guid" : "88893db5-4da5-93eb-45bf-73425cf7ce51", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Incident Management_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000326DMCAT_ProductSpecification_000151", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "__targetSystem" : "FULFILMENT", "name" : "Hosted UC", "CustomerFacingServiceId" : "", "id" : "", "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000315_Fulfilment", "description" : "", "endDate" : "", "guid" : "c362d71e-94a3-8415-528a-26f1e09cf39f", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Feature Packs_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000315", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "__targetSystem" : "FULFILMENT", "VoicePlan" : "Complete Premium", "id" : "", "CustomerFacingServiceId" : "", "Number" : [ { "schemaId" : "832ab1bd-4f74-5292-981d-7004e1ba8e58", "attributes" : { "FNN" : "3333333333", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "LE" } }, { "schemaId" : "5efc4e53-4f93-df2f-8a95-afbfb462cdab", "attributes" : { "FNN" : "8282345568", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } }, { "schemaId" : "0e129064-fdef-fa98-94ed-5be9dbb49e74", "attributes" : { "FNN" : "8282345526", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } } ] }, "code" : "DMCAT_ProductSpecification_000313_Fulfilment", "description" : "", "endDate" : "", "guid" : "033ce46a-f7de-48ca-23e6-41165dba9b65", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" } ] }');
        att1.Name = 'ServiceSpecifications.json';
        att1.ParentId = serv.Id;
        insert att1;
        
        //List<Attachment> atts = new List<Attachment>();
        Attachment att2 = new Attachment();
        att2.Body = Blob.valueOf('{ "legacyAttributes" : [ ], "serviceId" : "'+serv.Id+'", "specifications" : [ { "additionalAttributes" : { "IPWirelessProductInstanceID" : "91699412-512f-f8bd-2950-dedb06b0d13b", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "IPWirelessProductInstanceID" : "DMCAT_ProductSpecification_000018_Fulfilment", "__targetSystem" : "FULFILMENT", "SERVICEPROFILE" : "DATA_BACKUP", "MESSAGEBANK" : "NA", "INTROAM" : "NA", "CONTEXT" : "NA", "CALLCONTROL" : "NA", "AccessRole" : "Primary", "BillofMaterialID" : "160f44ab-6be5-433f-ab5e-750f44b8b19b", "SERVICEID" : "61429751286", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "", "ShippingRequired" : "TRUE", "IMSI" : "", "SIMSerialNumber" : "" }, "code" : "DMCAT_ProductSpecification_000263_Fulfilment", "description" : "", "endDate" : "", "guid" : "963263ce-cb0a-64cd-17d6-06b524f533e2", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "ASSURANCE", "ServiceManagementOption " : "1" }, "code" : "DMCAT_ProductSpecification_000326_Assurance", "description" : "", "endDate" : "", "guid" : "68af7760-5543-670c-1454-489b1e40d1ca", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Telstra Managed Service Option 1_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000326", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "T22E_MIA_DATPLAN", "type" : "Domestic Data", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Mobile", "billDescription" : "Mobile Interim Access Allowance", "SERVICEID" : "61429751286", "IMSI" : "" }, "code" : "DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "description" : "", "endDate" : "", "guid" : "4acc4396-bddd-31c9-71f8-77930cb5a68c", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "ocsProd3", "type" : "Dummy ngUC", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Voice", "billDescription" : "ngUC Dummy Usage Specification Allowance" }, "code" : "DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "description" : "", "endDate" : "", "guid" : "960b0d11-c4b0-21e9-d2a9-6f1aa15cd193", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "BSServiceTypeProductInstanceID" : "c557bd15-31b3-ccea-b9da-a9182979ac51", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "BSServiceTypeProductInstanceID" : "DMCAT_ProductSpecification_000312_Fulfilment", "__targetSystem" : "FULFILMENT", "CustomerFacingServiceId" : "", "CustomerPreferredName" : "", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "" }, "code" : "DMCAT_ProductSpecification_000322_Fulfilment", "description" : "", "endDate" : "", "guid" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Site_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000322", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "InternetProtectionSolutionProductInstanceID" : "97754883-23a9-375b-3af8-b991e4733a61" }, "attributes" : { "__targetSystem" : "FULFILMENT", "UserProtectionType" : "Web and Mail", "InternetProtectionSolutionProductInstanceID" : "DMCAT_ProductSpecification_000163_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000162_Fulfilment", "description" : "", "endDate" : "", "guid" : "79d6ca6f-8288-aadc-8247-e939262c37d3", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Web and Mail Internet Protection User_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000162", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "68af7760-5543-670c-1454-489b1e40d1ca" }, "attributes" : { "__targetSystem" : "ASSURANCE", "parentSpec" : "DMCAT_ProductSpecification_000326_Assurance", "ResponseTarget" : "", "RestoreTarget" : "" }, "code" : "DMCAT_ProductSpecification_000151_Assurance", "description" : "", "endDate" : "", "guid" : "88893db5-4da5-93eb-45bf-73425cf7ce51", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Incident Management_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000326DMCAT_ProductSpecification_000151", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "__targetSystem" : "FULFILMENT", "name" : "Hosted UC", "CustomerFacingServiceId" : "", "id" : "", "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000315_Fulfilment", "description" : "", "endDate" : "", "guid" : "c362d71e-94a3-8415-528a-26f1e09cf39f", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Feature Packs_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000315", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "__targetSystem" : "FULFILMENT", "VoicePlan" : "Complete Premium", "id" : "", "CustomerFacingServiceId" : "", "Number" : [ { "schemaId" : "832ab1bd-4f74-5292-981d-7004e1ba8e58", "attributes" : { "FNN" : "3333333333", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "LE" } }, { "schemaId" : "5efc4e53-4f93-df2f-8a95-afbfb462cdab", "attributes" : { "FNN" : "8282345568", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } }, { "schemaId" : "0e129064-fdef-fa98-94ed-5be9dbb49e74", "attributes" : { "FNN" : "8282345526", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } } ] }, "code" : "DMCAT_ProductSpecification_000313_Fulfilment", "description" : "", "endDate" : "", "guid" : "033ce46a-f7de-48ca-23e6-41165dba9b65", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" } ] }');
        att2.Name = 'ServiceSpecifications.json';
        att2.ParentId = serv1.Id;
        insert att2;
        try{
            
        Test.startTest();
     //  Set<Id> serviceIdSet = new Set<Id>();
       csord__Order__c order=[select id from csord__Order__c where name='test order'][0];
        
        CSPOFA__Orchestration_Process_Template__c parentTemplate = ProductTestService.getOrchProcessTemplate();
        CSPOFA__Orchestration_Process__c parentOrchProcess = ProductTestService.getNewOrchestrationProcess(parentTemplate);
        parentOrchProcess.Order__c= order.Id;
        CSPOFA__Orchestration_Step__c step = ProductTestService.getOrchStep(parentOrchProcess);
        List<CSPOFA__Orchestration_Step__c> steps = new List<CSPOFA__Orchestration_Step__c>();
        steps.add(step);
    
        Map<Id,csord__Service__c> serviceMap = new Map<Id,csord__Service__c>();
        serviceMap.put(serv1.id,serv1);
        //serviceIdSet.add(serv1.id);
        RecreateDeletedSpecsOrchStep.recreateDeletedSpecs(serviceMap);
        RecreateDeletedSpecsOrchStep rcr = new RecreateDeletedSpecsOrchStep();
        List<CSPOFA__Orchestration_Step__c> result = new List<CSPOFA__Orchestration_Step__c>();
        rcr.process(steps);
        
        Test.stopTest();
      //  System.assertEquals('Order Fulfilment Process',orchProcessName );
         system.assertEquals(result[0].CSPOFA__Message__c,'Custom Step succeeded');
        }catch(Exception e){
            
        }
    }
    
   /* static testMethod void createOchestrationProcessTestForSub() {
        list<CSPOFA__Orchestration_Process_Template__c> orcheList = new list<CSPOFA__Orchestration_Process_Template__c>();
        CSPOFA__Orchestration_Process_Template__c orchProcessTemplate1 = new CSPOFA__Orchestration_Process_Template__c();
        orchProcessTemplate1.Name = 'Service Fulfilment Process';
        orchProcessTemplate1.CSPOFA__Process_Type__c = 'New Provide';
        orchProcessTemplate1.CSPOFA__Processing_Mode__c = 'Foreground';
        orcheList.add(orchProcessTemplate1);
        insert orcheList;
        
        csord__Order__c ord = new csord__Order__c();
        ord.csord__Identification__c = 'test identification';
        ord.Name = 'test order';
        ord.csord__Status2__c = 'Pending';
        insert ord;
        
        csord__Subscription__c subs=new csord__Subscription__c();
        subs.name  = 'test subs';
        subs.csord__Identification__c = 'test identity';
        subs.csord__Status__c = 'Pending';
        subs.csord__Order__c = ord.id;
        insert subs;
        
        csord__Service__c serv = new csord__Service__c();
        serv.name ='tst service1';
        serv.csord__Identification__c  = 'test identify1';
        serv.csordtelcoa__Service_Number__c = '46543221';
        serv.csord__Subscription__c = subs.id;
        serv.csord__Order__c = ord.id;
        insert serv;
        
        csord__Service__c serv1 = new csord__Service__c();
        serv1.name ='tst service1';
        serv1.csord__Identification__c  = 'test identify1';
        serv1.csordtelcoa__Service_Number__c = '46543221';
        serv1.csord__Subscription__c = subs.id;
        serv1.csordtelcoa__Replaced_Service__c = serv.id;
        serv1.csord__Order__c = ord.id;
        insert serv1;
        
        List<Attachment> atts = new List<Attachment>();
        Attachment att1 = new Attachment();
        att1.Body = Blob.valueOf('{ "legacyAttributes" : [ ], "serviceId" : "'+serv.Id+'", "specifications" : [ { "additionalAttributes" : { "IPWirelessProductInstanceID" : "91699412-512f-f8bd-2950-dedb06b0d13b", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "IPWirelessProductInstanceID" : "DMCAT_ProductSpecification_000018_Fulfilment", "__targetSystem" : "FULFILMENT", "SERVICEPROFILE" : "DATA_BACKUP", "MESSAGEBANK" : "NA", "INTROAM" : "NA", "CONTEXT" : "NA", "CALLCONTROL" : "NA", "AccessRole" : "Primary", "BillofMaterialID" : "160f44ab-6be5-433f-ab5e-750f44b8b19b", "SERVICEID" : "61429751286", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "", "ShippingRequired" : "TRUE", "IMSI" : "", "SIMSerialNumber" : "" }, "code" : "DMCAT_ProductSpecification_000263_Fulfilment", "description" : "", "endDate" : "", "guid" : "963263ce-cb0a-64cd-17d6-06b524f533e2", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "ASSURANCE", "ServiceManagementOption " : "1" }, "code" : "DMCAT_ProductSpecification_000326_Assurance", "description" : "", "endDate" : "", "guid" : "68af7760-5543-670c-1454-489b1e40d1ca", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Telstra Managed Service Option 1_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000326", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "T22E_MIA_DATPLAN", "type" : "Domestic Data", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Mobile", "billDescription" : "Mobile Interim Access Allowance", "SERVICEID" : "61429751286", "IMSI" : "" }, "code" : "DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "description" : "", "endDate" : "", "guid" : "4acc4396-bddd-31c9-71f8-77930cb5a68c", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "ocsProd3", "type" : "Dummy ngUC", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Voice", "billDescription" : "ngUC Dummy Usage Specification Allowance" }, "code" : "DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "description" : "", "endDate" : "", "guid" : "960b0d11-c4b0-21e9-d2a9-6f1aa15cd193", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "BSServiceTypeProductInstanceID" : "c557bd15-31b3-ccea-b9da-a9182979ac51", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "BSServiceTypeProductInstanceID" : "DMCAT_ProductSpecification_000312_Fulfilment", "__targetSystem" : "FULFILMENT", "CustomerFacingServiceId" : "", "CustomerPreferredName" : "", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "" }, "code" : "DMCAT_ProductSpecification_000322_Fulfilment", "description" : "", "endDate" : "", "guid" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Site_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000322", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "InternetProtectionSolutionProductInstanceID" : "97754883-23a9-375b-3af8-b991e4733a61" }, "attributes" : { "__targetSystem" : "FULFILMENT", "UserProtectionType" : "Web and Mail", "InternetProtectionSolutionProductInstanceID" : "DMCAT_ProductSpecification_000163_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000162_Fulfilment", "description" : "", "endDate" : "", "guid" : "79d6ca6f-8288-aadc-8247-e939262c37d3", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Web and Mail Internet Protection User_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000162", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "68af7760-5543-670c-1454-489b1e40d1ca" }, "attributes" : { "__targetSystem" : "ASSURANCE", "parentSpec" : "DMCAT_ProductSpecification_000326_Assurance", "ResponseTarget" : "", "RestoreTarget" : "" }, "code" : "DMCAT_ProductSpecification_000151_Assurance", "description" : "", "endDate" : "", "guid" : "88893db5-4da5-93eb-45bf-73425cf7ce51", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Incident Management_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000326DMCAT_ProductSpecification_000151", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "__targetSystem" : "FULFILMENT", "name" : "Hosted UC", "CustomerFacingServiceId" : "", "id" : "", "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000315_Fulfilment", "description" : "", "endDate" : "", "guid" : "c362d71e-94a3-8415-528a-26f1e09cf39f", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Feature Packs_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000315", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "__targetSystem" : "FULFILMENT", "VoicePlan" : "Complete Premium", "id" : "", "CustomerFacingServiceId" : "", "Number" : [ { "schemaId" : "832ab1bd-4f74-5292-981d-7004e1ba8e58", "attributes" : { "FNN" : "3333333333", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "LE" } }, { "schemaId" : "5efc4e53-4f93-df2f-8a95-afbfb462cdab", "attributes" : { "FNN" : "8282345568", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } }, { "schemaId" : "0e129064-fdef-fa98-94ed-5be9dbb49e74", "attributes" : { "FNN" : "8282345526", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } } ] }, "code" : "DMCAT_ProductSpecification_000313_Fulfilment", "description" : "", "endDate" : "", "guid" : "033ce46a-f7de-48ca-23e6-41165dba9b65", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" } ] }');
        att1.Name = 'ServiceSpecifications.json';
        att1.ParentId = serv.Id;
        insert att1;
        
        //List<Attachment> atts = new List<Attachment>();
        Attachment att2 = new Attachment();
        att2.Body = Blob.valueOf('{ "legacyAttributes" : [ ], "serviceId" : "'+serv.Id+'", "specifications" : [ { "additionalAttributes" : { "IPWirelessProductInstanceID" : "91699412-512f-f8bd-2950-dedb06b0d13b", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "IPWirelessProductInstanceID" : "DMCAT_ProductSpecification_000018_Fulfilment", "__targetSystem" : "FULFILMENT", "SERVICEPROFILE" : "DATA_BACKUP", "MESSAGEBANK" : "NA", "INTROAM" : "NA", "CONTEXT" : "NA", "CALLCONTROL" : "NA", "AccessRole" : "Primary", "BillofMaterialID" : "160f44ab-6be5-433f-ab5e-750f44b8b19b", "SERVICEID" : "61429751286", "DMCAT_ProductSpecification_000263_CPEDeliveryDate" : "", "ShippingRequired" : "TRUE", "IMSI" : "", "SIMSerialNumber" : "" }, "code" : "DMCAT_ProductSpecification_000263_Fulfilment", "description" : "", "endDate" : "", "guid" : "963263ce-cb0a-64cd-17d6-06b524f533e2", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "ASSURANCE", "ServiceManagementOption " : "1" }, "code" : "DMCAT_ProductSpecification_000326_Assurance", "description" : "", "endDate" : "", "guid" : "68af7760-5543-670c-1454-489b1e40d1ca", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Telstra Managed Service Option 1_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000326", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "T22E_MIA_DATPLAN", "type" : "Domestic Data", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Mobile", "billDescription" : "Mobile Interim Access Allowance", "SERVICEID" : "61429751286", "IMSI" : "" }, "code" : "DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "description" : "", "endDate" : "", "guid" : "4acc4396-bddd-31c9-71f8-77930cb5a68c", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Mobile Access_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000263_Billing_Allowance_000494_3", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { }, "attributes" : { "__targetSystem" : "BILLING", "billingSpecId" : "BSUSG001_CB", "ocsProdID" : "ocsProd3", "type" : "Dummy ngUC", "unitofMeasure" : "GB", "value" : "Unlimited", "RoutingServiceType" : "Voice", "billDescription" : "ngUC Dummy Usage Specification Allowance" }, "code" : "DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "description" : "", "endDate" : "", "guid" : "960b0d11-c4b0-21e9-d2a9-6f1aa15cd193", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Bill_AW", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313_Billing_Allowance_000512_4", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "BSServiceTypeProductInstanceID" : "c557bd15-31b3-ccea-b9da-a9182979ac51", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "2019-03-14T08:00:00" }, "attributes" : { "BSServiceTypeProductInstanceID" : "DMCAT_ProductSpecification_000312_Fulfilment", "__targetSystem" : "FULFILMENT", "CustomerFacingServiceId" : "", "CustomerPreferredName" : "", "DMCAT_ProductSpecification_000322_CPEDeliveryDate" : "" }, "code" : "DMCAT_ProductSpecification_000322_Fulfilment", "description" : "", "endDate" : "", "guid" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Site_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000322", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "InternetProtectionSolutionProductInstanceID" : "97754883-23a9-375b-3af8-b991e4733a61" }, "attributes" : { "__targetSystem" : "FULFILMENT", "UserProtectionType" : "Web and Mail", "InternetProtectionSolutionProductInstanceID" : "DMCAT_ProductSpecification_000163_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000162_Fulfilment", "description" : "", "endDate" : "", "guid" : "79d6ca6f-8288-aadc-8247-e939262c37d3", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Web and Mail Internet Protection User_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductOffering_000304DMCAT_ProductSpecification_000162", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "68af7760-5543-670c-1454-489b1e40d1ca" }, "attributes" : { "__targetSystem" : "ASSURANCE", "parentSpec" : "DMCAT_ProductSpecification_000326_Assurance", "ResponseTarget" : "", "RestoreTarget" : "" }, "code" : "DMCAT_ProductSpecification_000151_Assurance", "description" : "", "endDate" : "", "guid" : "88893db5-4da5-93eb-45bf-73425cf7ce51", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Incident Management_Assurance", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000326DMCAT_ProductSpecification_000151", "startDate" : "", "status" : "Disconnect Pending", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "__targetSystem" : "FULFILMENT", "name" : "Hosted UC", "CustomerFacingServiceId" : "", "id" : "", "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "Quantity" : "3" }, "code" : "DMCAT_ProductSpecification_000315_Fulfilment", "description" : "", "endDate" : "", "guid" : "c362d71e-94a3-8415-528a-26f1e09cf39f", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "Feature Packs_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000315", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" }, { "additionalAttributes" : { "parentSpec" : "70e2316f-6e03-54f5-38e6-d0d3eedb7c22" }, "attributes" : { "parentSpec" : "DMCAT_ProductSpecification_000322_Fulfilment", "__targetSystem" : "FULFILMENT", "VoicePlan" : "Complete Premium", "id" : "", "CustomerFacingServiceId" : "", "Number" : [ { "schemaId" : "832ab1bd-4f74-5292-981d-7004e1ba8e58", "attributes" : { "FNN" : "3333333333", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "LE" } }, { "schemaId" : "5efc4e53-4f93-df2f-8a95-afbfb462cdab", "attributes" : { "FNN" : "8282345568", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } }, { "schemaId" : "0e129064-fdef-fa98-94ed-5be9dbb49e74", "attributes" : { "FNN" : "8282345526", "rangeFrom" : null, "rangeTo" : null, "status" : "RESERVED", "listCode" : "No Entry Line" } } ] }, "code" : "DMCAT_ProductSpecification_000313_Fulfilment", "description" : "", "endDate" : "", "guid" : "033ce46a-f7de-48ca-23e6-41165dba9b65", "includeBilling" : false, "instanceId" : "", "metadata" : { }, "name" : "UC Numbers_Fulfilment", "productConfigurationId" : "a3T2O000000GuQXUA0", "specification" : "DMCAT_ProductSpecification_000322DMCAT_ProductSpecification_000313", "startDate" : "", "status" : "Disconnect In Progress", "version" : "1" } ] }');
        att2.Name = 'ServiceSpecifications.json';
        att2.ParentId = serv1.Id;
        insert att2;
        
        Test.startTest();
        //Set<Id> serviceIdSet = new Set<Id>();
        String orchProcessName = 'Subscription Fulfilment Process';
        Map<Id,csord__Service__c> serviceMap = new Map<Id,csord__Service__c>();
        serviceMap.put(serv1.id,serv1);
        RecreateDeletedSpecsOrchStep.recreateDeletedSpecs(serviceMap);
        RecreateDeletedSpecsOrchStep rcr = new RecreateDeletedSpecsOrchStep();
        List<CSPOFA__Orchestration_Step__c> result = new List<CSPOFA__Orchestration_Step__c>();
        rcr.process(result);
        System.assertEquals('Subscription Fulfilment Process',orchProcessName );
        Test.stopTest();
    }*/
}